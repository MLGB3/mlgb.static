{% extends "base.html" %}
{% load mlgb_custom_filters %}

{% block title %}
<title>MLGB3 Treeviewer</title>
{% endblock %}

{% block content_wrapper %}
<div id="searchresults">
{% block maincontent %}

  {# ========== start treeview containing search results ========== #}
  <div id="{% if number_of_records %}mlgbtreeview{% else %}nonefound{% endif %}" class="boxed treeview">
  <h2 class="heading">Search Results</h2>

  <div class="resultdetails">
  
  {% if search_term %}
    <div class="treeheader">
    {% if search_term == '*' %}
    Displaying all records...
    {% else %}
    Searching {{field_label|lower|default:"all fields"}} for: <strong> {{search_term}}</strong>
    {% endif %}
    </div><!-- end div class "treeheader" -->
  {% endif %}

  {% if not number_of_records %}
    {% if search_term %}<p>No records retrieved.</p>{% endif %}
  {% endif %}

  {% if result_string %} {# the HTML for the search results is already set in variable 'result_string' #}
    {% autoescape off %}{{ result_string|fix_dashes }}{% endautoescape %}
  {% endif %}
  </div> <!-- end div class resultdetails -->

  </div><!-- end div ID "mlgbtreeview" -->
  {# =========== end treeview containing search results =========== #}

{% endblock %} {# end block 'maincontent' #}

{% block search %}  
  <div id="search" class="boxed">
    <h2 class="heading">Search
    {% if search_term %} Again {% endif %}
    </h2>
    <div class="pretty-print">

    {# ================== start search form ================== #}
    <form action="/mlgb/" method="get">
      <div>
      <label for="search_term">Enter your search term: </label>
      <br>
      <input name="search_term" id="search_term" type="text" size="30" 
      {% if search_term == "*" or not search_term %} 
      value=""
      {% else %}
      value="{{search_term}}" 
      {% endif %}
      /> <br > <br >

      <label for="field_to_search">Field to search: </label>
      <br />
      {% for field_dict in searchable_fields %}
        {% for val, desc in field_dict.items %}
        <input type="radio" value="{{val}}" name="field_to_search" id="search_{{val|default:'all'}}"
        {% if val == field_to_search %} CHECKED {% endif %}
        /> 
        <label for="search_{{val|default:'all'}}">
        {{desc}} 
        </label>
        <br>
        {% endfor %}
      {% endfor %}
      <br />

      <label for="page_size">Records per page: </label>
      <br />
      {% for possible_size in page_sizes %}
        <input type="radio" value="{{possible_size}}" name="page_size" id="page_size_{{possible_size}}"
        {% if page_size %}
          {% if possible_size == page_size %} CHECKED {% endif %}
        {% else %}
          {% if possible_size|lower == 'all' %} CHECKED {% endif %}
        {% endif %}
        />
        <label for="page_size_{{possible_size}}"> 
        {{possible_size}} 
        </label>
        <br>
      {% endfor %}

      <br />

      <script type="text/javascript">
      function clearSearchFields() {

        var search_term = document.getElementById( 'search_term' );
        search_term.value = "";

        {% for field_dict in searchable_fields %} {% for val, desc in field_dict.items %}
        var oneField = document.getElementById( 'search_{{val|default:"all"}}' );
        if( oneField.value == '') {
          oneField.checked = true;
        }
        else {
          oneField.checked = false;
        }
        {% endfor %} {% endfor %}

        {% for possible_size in page_sizes %}
        var pageSize = document.getElementById( 'page_size_{{possible_size}}' );
        if( pageSize.value.toLowerCase() == '{{default_rows_per_page}}' ) {
          pageSize.checked = true;
        }
        else {
          pageSize.checked = false;
        }
        {% endfor %}
      }
      </script>

      <input type="submit" value="Go" />
      <input type="button" value="Clear" onclick="clearSearchFields()" />
      </div>
    </form>
    {# ================== end search form ================== #}

    </div> <!-- end div class "pretty-print" -->
  </div>   <!-- end div id "search" -->
{% endblock %}

{% block archives %} 
{% endblock %}

{% block useful_links %} 
{% endblock %}

</div> <!-- end div id="searchresults" -->
{% endblock %}{# end block 'content_wrapper' #}

